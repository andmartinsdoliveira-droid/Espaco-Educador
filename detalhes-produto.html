<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Produto - Espa√ßo do Educador</title>
    <meta name="description" content="Conhe√ßa os detalhes do produto educacional e adicione ao seu carrinho.">
    <link rel="stylesheet" href="assets/css/styles-educacional.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéì</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">Espa√ßo do Educador</a>
                
                <nav class="nav">
                    <a href="index.html" class="nav-link">In√≠cio</a>
                    <a href="sobre.html" class="nav-link">Sobre</a>
                    <a href="contato.html" class="nav-link">Contato</a>
                </nav>
                
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Buscar recursos..." readonly onclick="window.location.href='index.html'">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Breadcrumb -->
        <nav style="margin: var(--espacamento-lg) 0;">
            <div style="display: flex; align-items: center; gap: var(--espacamento-xs); color: var(--cor-cinza-escuro); font-size: 0.9rem;">
                <a href="index.html" style="color: var(--cor-azul-sereno); text-decoration: none;">üè† In√≠cio</a>
                <span>‚Ä∫</span>
                <span id="breadcrumbProduto">Produto</span>
            </div>
        </nav>

        <!-- Loading -->
        <div id="loading" class="loading-overlay" style="display: none;">
            <div class="loading loading-large"></div>
        </div>

        <!-- Produto n√£o encontrado -->
        <div id="produtoNaoEncontrado" style="display: none; text-align: center; padding: var(--espacamento-xxl) 0;">
            <div style="font-size: 5rem; margin-bottom: var(--espacamento-lg);">üòï</div>
            <h2>Produto n√£o encontrado</h2>
            <p style="color: var(--cor-cinza-escuro); margin-bottom: var(--espacamento-xl);">
                O produto que voc√™ est√° procurando n√£o foi encontrado ou n√£o existe mais.
            </p>
            <a href="index.html" class="btn btn-primary">üè† Voltar ao Cat√°logo</a>
        </div>

        <!-- Detalhes do Produto -->
        <div id="produtoDetalhes" style="display: none;">
            <!-- Produto Principal -->
            <section style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--espacamento-xxl); margin-bottom: var(--espacamento-xxl); align-items: start;">
                <!-- Galeria de Imagens -->
                <div>
                    <div class="card">
                        <div class="card-body" style="padding: 0;">
                            <div id="imagemPrincipal" style="width: 100%; height: 400px; background: linear-gradient(135deg, var(--cor-azul-ceu) 0%, var(--cor-rosa-carinho) 100%); display: flex; align-items: center; justify-content: center; font-size: 5rem; color: white; border-radius: var(--borda-radius-lg) var(--borda-radius-lg) 0 0;">
                                üìö
                            </div>
                            <div id="miniaturas" style="display: flex; gap: var(--espacamento-sm); padding: var(--espacamento-md); justify-content: center;">
                                <!-- Miniaturas ser√£o inseridas aqui via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informa√ß√µes do Produto -->
                <div>
                    <div class="card">
                        <div class="card-body">
                            <h1 id="produtoTitulo" style="color: var(--cor-azul-sereno); margin-bottom: var(--espacamento-md);">Carregando...</h1>
                            
                            <div id="produtoPreco" style="font-size: 2rem; font-weight: bold; color: var(--cor-verde-esperanca); margin-bottom: var(--espacamento-lg);">
                                R$ 0,00
                            </div>

                            <div id="produtoDescricao" style="color: var(--cor-cinza-escuro); line-height: 1.6; margin-bottom: var(--espacamento-xl);">
                                Carregando descri√ß√£o...
                            </div>

                            <div style="display: flex; gap: var(--espacamento-md); margin-bottom: var(--espacamento-lg);">
                                <button id="btnAdicionarCarrinho" class="btn btn-primary btn-lg" style="flex: 1;">
                                    üõí Adicionar ao Carrinho
                                </button>
                                <button id="btnComprarAgora" class="btn btn-success btn-lg">
                                    ‚ö° Comprar Agora
                                </button>
                            </div>

                            <div class="alert alert-info">
                                <h4 style="margin-bottom: var(--espacamento-sm); color: var(--cor-azul-sereno);">‚úÖ O que voc√™ vai receber:</h4>
                                <ul style="margin: 0; padding-left: var(--espacamento-lg);">
                                    <li>Acesso imediato ap√≥s a compra</li>
                                    <li>Material em PDF de alta qualidade</li>
                                    <li>Pronto para impress√£o</li>
                                    <li>Suporte pedag√≥gico inclu√≠do</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Informa√ß√µes Adicionais -->
            <section class="card" style="margin-bottom: var(--espacamento-xxl);">
                <div class="card-header">
                    <h2 style="margin: 0; color: white;">Informa√ß√µes do Produto</h2>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--espacamento-lg);">
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: var(--espacamento-sm);">üìÑ</div>
                            <h4>Formato</h4>
                            <p style="color: var(--cor-cinza-escuro);">PDF Digital</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: var(--espacamento-sm);">üñ®Ô∏è</div>
                            <h4>Impress√£o</h4>
                            <p style="color: var(--cor-cinza-escuro);">Alta Qualidade</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: var(--espacamento-sm);">‚ö°</div>
                            <h4>Entrega</h4>
                            <p style="color: var(--cor-cinza-escuro);">Imediata</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: var(--espacamento-sm);">üí¨</div>
                            <h4>Suporte</h4>
                            <p style="color: var(--cor-cinza-escuro);">Inclu√≠do</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Produtos Relacionados -->
            <section style="margin-bottom: var(--espacamento-xxl);">
                <h2 style="text-align: center; margin-bottom: var(--espacamento-xl);">Voc√™ Tamb√©m Pode Gostar</h2>
                <div id="produtosRelacionados" class="produtos-grid">
                    <!-- Produtos relacionados ser√£o carregados aqui -->
                </div>
            </section>
        </div>

        <!-- Mensagens -->
        <div id="mensagens"></div>
    </main>

    <!-- Carrinho Flutuante -->
    <div class="carrinho-flutuante">
        <button id="carrinhoBtn" class="carrinho-btn" title="Ver Carrinho">
            üõí
            <span id="carrinhoContador" class="carrinho-contador" style="display: none;">0</span>
        </button>
    </div>

    <!-- Modal do Carrinho -->
    <div id="carrinhoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Meu Carrinho</h3>
                <button id="fecharCarrinho" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="carrinhoItens">
                    <!-- Itens do carrinho ser√£o carregados aqui -->
                </div>
                <div id="carrinhoVazio" style="text-align: center; padding: 2rem; display: none;">
                    <p>Seu carrinho est√° vazio</p>
                    <p style="color: var(--cor-cinza-escuro); font-size: 0.9rem;">Adicione alguns recursos pedag√≥gicos para come√ßar!</p>
                </div>
            </div>
            <div class="modal-footer">
                <div style="width: 100%;">
                    <div id="carrinhoTotal" style="text-align: right; margin-bottom: 1rem;">
                        <strong>Total: R$ <span id="valorTotal">0,00</span></strong>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button id="limparCarrinho" class="btn btn-outline">Limpar Carrinho</button>
                        <button id="finalizarCompra" class="btn btn-success">Finalizar Compra</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Espa√ßo do Educador</h3>
                    <p>Recursos pedag√≥gicos de qualidade para transformar a educa√ß√£o e inspirar o aprendizado.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Links √öteis</h3>
                    <p><a href="index.html">Cat√°logo</a></p>
                    <p><a href="sobre.html">Sobre N√≥s</a></p>
                    <p><a href="contato.html">Contato</a></p>
                </div>
                
                <div class="footer-section">
                    <h3>Suporte</h3>
                    <p>üìß contato@espacodoeducador.com</p>
                    <p>üì± (11) 99999-9999</p>
                    <p>üïí Seg-Sex: 8h √†s 18h</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Espa√ßo do Educador. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/cart.js"></script>
    <script>
        // Configura√ß√£o do backend
        const BACKEND_URL = 'https://script.google.com/macros/s/AKfycbyFdvit_mfI_j9g5D0hOMYzhSmu5U7ycIef891mkd02fzIja_XEqreQAr5uq4G-bOfE/exec';
        
        // Estado da aplica√ß√£o
        let produtos = [];
        let produtoAtual = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            inicializarApp();
        });

        async function inicializarApp() {
            try {
                mostrarLoading(true);
                await carregarProdutos();
                const produtoId = obterIdProduto();
                if (produtoId) {
                    await carregarProduto(produtoId);
                } else {
                    mostrarProdutoNaoEncontrado();
                }
                configurarEventListeners();
                atualizarContadorCarrinho();
                mostrarLoading(false);
            } catch (error) {
                console.error('Erro ao inicializar app:', error);
                mostrarMensagem('Erro ao carregar o produto. Tente novamente mais tarde.', 'error');
                mostrarLoading(false);
            }
        }

        function obterIdProduto() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        async function carregarProdutos() {
            try {
                const response = await fetch(BACKEND_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                produtos = Array.isArray(data) ? data : [];
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                throw error;
            }
        }

        async function carregarProduto(id) {
            produtoAtual = produtos.find(p => p.ID == id);
            
            if (!produtoAtual) {
                mostrarProdutoNaoEncontrado();
                return;
            }

            // Atualizar informa√ß√µes do produto
            document.getElementById('produtoTitulo').textContent = produtoAtual.Nome;
            document.getElementById('produtoPreco').textContent = formatarPreco(produtoAtual.Pre√ßo);
            document.getElementById('produtoDescricao').textContent = produtoAtual.Descri√ß√£o;
            document.getElementById('breadcrumbProduto').textContent = produtoAtual.Nome;
            document.title = `${produtoAtual.Nome} - Espa√ßo do Educador`;

            // Atualizar imagem
            const imagemPrincipal = document.getElementById('imagemPrincipal');
            if (produtoAtual.URL_Imagem) {
                imagemPrincipal.innerHTML = `<img src="${produtoAtual.URL_Imagem}" alt="${produtoAtual.Nome}" style="width: 100%; height: 100%; object-fit: cover; border-radius: var(--borda-radius-lg) var(--borda-radius-lg) 0 0;">`;
            }

            // Carregar produtos relacionados
            carregarProdutosRelacionados();

            // Mostrar detalhes
            document.getElementById('produtoDetalhes').style.display = 'block';
        }

        function carregarProdutosRelacionados() {
            const produtosRelacionados = produtos
                .filter(p => p.ID != produtoAtual.ID)
                .slice(0, 3);

            const container = document.getElementById('produtosRelacionados');
            container.innerHTML = produtosRelacionados.map(produto => `
                <div class="produto-card">
                    <div class="produto-imagem">
                        ${produto.URL_Imagem ? 
                            `<img src="${produto.URL_Imagem}" alt="${produto.Nome}" onerror="this.parentElement.innerHTML='üìö'">` : 
                            'üìö'
                        }
                    </div>
                    <div class="produto-info">
                        <h3 class="produto-titulo">${produto.Nome}</h3>
                        <p class="produto-descricao">${produto.Descri√ß√£o}</p>
                        <div class="produto-preco">${formatarPreco(produto.Pre√ßo)}</div>
                        <div class="produto-acoes">
                            <a href="detalhes-produto.html?id=${produto.ID}" class="btn btn-secondary">Ver Detalhes</a>
                            <button onclick="adicionarAoCarrinho(${produto.ID})" class="btn btn-primary">Adicionar ao Carrinho</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function mostrarProdutoNaoEncontrado() {
            document.getElementById('produtoNaoEncontrado').style.display = 'block';
        }

        function configurarEventListeners() {
            // Bot√µes do produto
            document.getElementById('btnAdicionarCarrinho').addEventListener('click', () => {
                if (produtoAtual) {
                    adicionarAoCarrinho(produtoAtual.ID);
                }
            });

            document.getElementById('btnComprarAgora').addEventListener('click', () => {
                if (produtoAtual) {
                    adicionarAoCarrinho(produtoAtual.ID);
                    abrirCarrinho();
                }
            });

            // Carrinho
            document.getElementById('carrinhoBtn').addEventListener('click', abrirCarrinho);
            document.getElementById('fecharCarrinho').addEventListener('click', fecharCarrinho);
            document.getElementById('limparCarrinho').addEventListener('click', limparCarrinho);
            document.getElementById('finalizarCompra').addEventListener('click', finalizarCompra);

            // Modal
            document.getElementById('carrinhoModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    fecharCarrinho();
                }
            });
        }

        function adicionarAoCarrinho(produtoId) {
            const produto = produtos.find(p => p.ID == produtoId);
            if (produto) {
                Cart.adicionarItem(produto);
                atualizarContadorCarrinho();
                mostrarMensagem(`${produto.Nome} foi adicionado ao carrinho!`, 'success');
            }
        }

        function atualizarContadorCarrinho() {
            const contador = document.getElementById('carrinhoContador');
            const totalItens = Cart.getTotalItens();
            
            if (totalItens > 0) {
                contador.textContent = totalItens;
                contador.style.display = 'flex';
            } else {
                contador.style.display = 'none';
            }
        }

        function abrirCarrinho() {
            const modal = document.getElementById('carrinhoModal');
            const itensContainer = document.getElementById('carrinhoItens');
            const vazioContainer = document.getElementById('carrinhoVazio');
            const itens = Cart.getItens();

            if (itens.length === 0) {
                itensContainer.innerHTML = '';
                vazioContainer.style.display = 'block';
            } else {
                vazioContainer.style.display = 'none';
                itensContainer.innerHTML = itens.map(item => `
                    <div class="carrinho-item">
                        <div class="carrinho-item-imagem">
                            ${item.URL_Imagem ? 
                                `<img src="${item.URL_Imagem}" alt="${item.Nome}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">` : 
                                '<div style="width: 60px; height: 60px; background: var(--cor-azul-ceu); display: flex; align-items: center; justify-content: center; border-radius: 4px; font-size: 1.5rem;">üìö</div>'
                            }
                        </div>
                        <div class="carrinho-item-info">
                            <div class="carrinho-item-nome">${item.Nome}</div>
                            <div class="carrinho-item-preco">${formatarPreco(item.Pre√ßo)}</div>
                        </div>
                        <div class="carrinho-item-acoes">
                            <button class="btn-quantidade" onclick="Cart.diminuirQuantidade(${item.ID}); atualizarCarrinho();">-</button>
                            <input type="number" class="quantidade-input" value="${item.quantidade}" min="1" onchange="Cart.atualizarQuantidade(${item.ID}, this.value); atualizarCarrinho();">
                            <button class="btn-quantidade" onclick="Cart.aumentarQuantidade(${item.ID}); atualizarCarrinho();">+</button>
                            <button class="btn btn-outline btn-sm" onclick="Cart.removerItem(${item.ID}); atualizarCarrinho();" style="margin-left: 1rem;">Remover</button>
                        </div>
                    </div>
                `).join('');
            }

            atualizarTotalCarrinho();
            modal.classList.add('show');
        }

        function fecharCarrinho() {
            document.getElementById('carrinhoModal').classList.remove('show');
        }

        function atualizarCarrinho() {
            abrirCarrinho();
            atualizarContadorCarrinho();
        }

        function atualizarTotalCarrinho() {
            const total = Cart.getTotal();
            document.getElementById('valorTotal').textContent = formatarPreco(total).replace('R$ ', '');
        }

        function limparCarrinho() {
            if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                Cart.limpar();
                atualizarCarrinho();
                atualizarContadorCarrinho();
                mostrarMensagem('Carrinho limpo com sucesso!', 'success');
            }
        }

        function finalizarCompra() {
            const itens = Cart.getItens();
            if (itens.length === 0) {
                mostrarMensagem('Adicione itens ao carrinho antes de finalizar a compra.', 'warning');
                return;
            }

            // Aqui voc√™ pode implementar a integra√ß√£o com o sistema de pagamento
            mostrarMensagem('Funcionalidade de pagamento ser√° implementada em breve!', 'info');
        }

        function mostrarLoading(mostrar) {
            const loading = document.getElementById('loading');
            loading.style.display = mostrar ? 'flex' : 'none';
        }

        function mostrarMensagem(texto, tipo = 'info') {
            const container = document.getElementById('mensagens');
            const div = document.createElement('div');
            div.className = `alert alert-${tipo}`;
            div.textContent = texto;
            
            container.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 5000);
        }

        function formatarPreco(preco) {
            const valor = parseFloat(preco) || 0;
            return `R$ ${valor.toFixed(2).replace('.', ',')}`;
        }
    </script>
</body>
</html>

